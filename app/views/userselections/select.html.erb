<div class="container">
  <div class="row">
    <div class="col-sm-2">
      <!-- If logged in do this -->
      <% if user_signed_in? %>
      <div>
        <% if @user_selections.present? %>
        <h3>Selected companies</h3>
        <ul class="list-inline list-margin">
          <% @user_selections.each do |selection| %>
          <% @companies.each do |company| %>
          <% if company.id == selection.company_id %>
          <li><%= company.name.sub(/^./, &:upcase) %>
            <%= simple_form_for(@user_selection) do |f| %>
            <%= link_to destroy_user_selections_path(selection), :method => :delete do %>
            <i class="fa fa-times-circle"></i>
            <% end %>
          </li>
          <% end %>
          <% end %>
          <% end %>
          <% end %>
        </ul>
        <% end %>
      </div>
    </div>
    <div class="col-sm-offset-2 col-sm-8">
      <div class="flexcontainer">
        <div class="flexform">

          <h3> Select organizations and get your data! </h3>
          <%= link_to "Add Organization", new_company_path %>
          <div class="search">
            <%= form_tag companies_path+'#target-div', method: :get do %>
            <%= text_field_tag :query,
            params[:query],
            class: "form-control"
              %>
              <% end %>
            </div>

            <div id="target-div">
              <% selection_array = [] %>
              <h3>Not selected companies</h3>
              <% if @user_selections.present? %>
              <% @user_selections.each do |selection| %>
              <% selection_array << selection.company_id %>
              <% end %>
              <% @companies.each do |company| %>
              <% if !selection_array.include?(company.id)  %>
              <div class="card-dashboard">
                <p><strong><%= link_to company.name, company_path(company) %></strong></p>
                <p><%= company.email %></p>
                <p><%= company.category %></p>
                <p><%= company.url %></p>
                <%= simple_form_for(@user_selection) do |f| %>
                <%= f.input :company_id, :as => :hidden, :input_html => { :value => company.id }  %>
                <%= f.button :submit, "select" %>
                <% end %>
              </div>
              <% end %>
              <% end %>

              <% else %>
              <% @companies.each do |company| %>
              <div class="card-dashboard">
                <p><strong><%= link_to company.name, company_path(company) %></strong></p>
                <p><%= company.email %></p>
                <p><%= company.category %></p>
                <p><%= company.url %></p>
                <%= simple_form_for(@user_selection) do |f| %>
                <%= f.input :company_id, :as => :hidden, :input_html => { :value => company.id }  %>
                <%= f.button :submit, "select" %>
                <% end %>
              </div>
              <% end %>
              <% end %>
            </div>
          </div>

          <!-- If not logged in do this-->
          <% else %>
          <h2> Search organizations</h2>
          <div class="search">
            <%= form_tag companies_path+'#target-div', method: :get do %>
            <%= text_field_tag :query,
            params[:query],
            class: "form-control"
              %>
              <% end %>
            </div>

            <h3>Companies</h3>
            <div id="target-div">
              <% @companies.each do |company| %>
              <div class="card-dashboard">
                <p><strong><%= link_to company.name, company_path(company) %></strong></p>
                <p><%= company.email %></p>
                <p><%= company.category %></p>
                <p><%= company.url %></p>
              </div>
              <% end %>
              <% end %>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>


  <%= link_to root_path, :class => "wizzard-button btn-left" do %>
  Home
  <% end %>

  <%= link_to sendmessages_path, :class => "wizzard-button btn-right" do %>
  Messages overview
  <% end %>
